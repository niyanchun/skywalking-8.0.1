{"remainingRequest":"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/thread-loader/dist/cjs.js!/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/babel-loader/lib/index.js!/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/src/views/components/trace/d3-trace-tree.js","dependencies":[{"path":"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/src/views/components/trace/d3-trace-tree.js","mtime":1592485041000},{"path":"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _Set from \"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/@babel/runtime-corejs2/core-js/set\";\nimport _Array$from from \"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/@babel/runtime-corejs2/core-js/array/from\";\nimport _classCallCheck from \"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable */\nimport * as d3 from 'd3';\nimport d3tip from 'd3-tip';\nvar i = 0;\n\nvar TraceMap =\n/*#__PURE__*/\nfunction () {\n  function TraceMap(el, scope) {\n    _classCallCheck(this, TraceMap);\n\n    this.el = el;\n    this.scope = scope;\n    this.i = 0;\n    this.topSlow = [];\n    this.topChild = [];\n    this.width = el.clientWidth;\n    this.height = el.clientHeight - 28;\n    this.body = d3.select(this.el).append('svg').attr('width', this.width).attr('height', this.height);\n    this.tip = d3tip().attr('class', 'd3-tip').offset([-8, 0]).html(function (d) {\n      return \"\\n      <div class=\\\"mb-5\\\">\".concat(d.data.label, \"</div>\\n      \").concat(d.data.dur ? '<div class=\"sm\">SelfDuration: ' + d.data.dur + 'ms</div>' : '', \"\\n      \").concat(d.data.endTime - d.data.startTime ? '<div class=\"sm\">TotalDuration: ' + (d.data.endTime - d.data.startTime) + 'ms</div>' : '', \"\\n      \");\n    });\n    this.svg = this.body.append('g').attr('transform', function (d) {\n      return \"translate(120, 0)\";\n    });\n    this.svg.call(this.tip);\n  }\n\n  _createClass(TraceMap, [{\n    key: \"resize\",\n    value: function resize() {\n      // reset svg size\n      this.width = this.el.clientWidth;\n      this.height = this.el.clientHeight - 28;\n      this.body.attr('width', this.width).attr('height', this.height);\n      this.body.select('g').attr('transform', function (d) {\n        return \"translate(160, 0)\";\n      }); // reset zoom function for translate\n\n      var transform = d3.zoomTransform(0).translate(0, 0);\n      d3.zoom().transform(this.body, transform);\n    }\n  }, {\n    key: \"init\",\n    value: function init(data, row) {\n      var _this = this;\n\n      this.treemap = d3.tree().size([row.length * 35, this.width]);\n      this.row = row;\n      this.data = data;\n      this.min = d3.min(this.row.map(function (i) {\n        return i.startTime;\n      }));\n      this.max = d3.max(this.row.map(function (i) {\n        return i.endTime - _this.min;\n      }));\n      this.list = _Array$from(new _Set(this.row.map(function (i) {\n        return i.serviceCode;\n      })));\n      this.xScale = d3.scaleLinear().range([0, 100]).domain([0, this.max]);\n      this.sequentialScale = d3.scaleSequential().domain([0, this.list.length + 1]).interpolator(d3.interpolateCool);\n      this.body.call(this.getZoomBehavior(this.svg));\n      this.root = d3.hierarchy(this.data, function (d) {\n        return d.children;\n      });\n      this.root.x0 = this.height / 2;\n      this.root.y0 = 0;\n      this.topSlow = [];\n      this.topChild = [];\n      var that = this;\n      this.root.children.forEach(collapse);\n      this.topSlowMax = this.topSlow.sort(function (a, b) {\n        return b - a;\n      })[0];\n      this.topSlowMin = this.topSlow.sort(function (a, b) {\n        return b - a;\n      })[4];\n      this.topChildMax = this.topChild.sort(function (a, b) {\n        return b - a;\n      })[0];\n      this.topChildMin = this.topChild.sort(function (a, b) {\n        return b - a;\n      })[4];\n      this.update(this.root); // Collapse the node and all it's children\n\n      function collapse(d) {\n        if (d.children) {\n          var dur = d.data.endTime - d.data.startTime;\n          d.children.forEach(function (i) {\n            dur -= i.data.endTime - i.data.startTime;\n          });\n          d.dur = dur < 0 ? 0 : dur;\n          that.topSlow.push(dur);\n          that.topChild.push(d.children.length);\n          d.childrenLength = d.children.length;\n          d.children.forEach(collapse);\n        }\n      }\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      this.update(this.root);\n    }\n  }, {\n    key: \"update\",\n    value: function update(source) {\n      var _this2 = this;\n\n      var that = this;\n      var treeData = this.treemap(this.root);\n      var nodes = treeData.descendants(),\n          links = treeData.descendants().slice(1);\n      nodes.forEach(function (d) {\n        d.y = d.depth * 140;\n      });\n      var node = this.svg.selectAll('g.node').data(nodes, function (d) {\n        return d.id || (d.id = ++i);\n      });\n      var nodeEnter = node.enter().append('g').attr('class', 'node').attr('cursor', 'pointer').attr('transform', function (d) {\n        return 'translate(' + source.y0 + ',' + source.x0 + ')';\n      }).on('mouseover', function (d, i) {\n        that.tip.show(d, this);\n\n        if (!that.timeUpdate) {\n          return;\n        }\n\n        var _node = that.timeUpdate._groups[0].filter(function (group) {\n          return group.__data__.id === i + 1;\n        });\n\n        if (_node.length) {\n          that.timeTip.show(d, _node[0].children[1]);\n        }\n      }).on('mouseout', function (d, i) {\n        that.tip.hide(d, this);\n\n        if (!that.timeUpdate) {\n          return;\n        }\n\n        var _node = that.timeUpdate._groups[0].filter(function (group) {\n          return group.__data__.id === i + 1;\n        });\n\n        if (_node.length) {\n          that.timeTip.hide(d, _node[0].children[1]);\n        }\n      }).on('click', function (d) {\n        d3.event.stopPropagation();\n        that.scope.handleSelectSpan(d);\n      });\n      nodeEnter.append('circle').attr('class', 'node').attr('r', 1e-6).style('fill', function (d) {\n        return d._children ? _this2.sequentialScale(_this2.list.indexOf(d.data.serviceCode)) : '#fff';\n      }).attr('stroke', function (d) {\n        return _this2.sequentialScale(_this2.list.indexOf(d.data.serviceCode));\n      }).attr('stroke-width', 2.5);\n      nodeEnter.append('text').attr('font-size', 11).attr('dy', '-0.5em').attr('x', function (d) {\n        return d.children || d._children ? -15 : 15;\n      }).attr('text-anchor', function (d) {\n        return d.children || d._children ? 'end' : 'start';\n      }).text(function (d) {\n        return d.data.label.length > 19 ? (d.data.isError ? '◉ ' : '') + d.data.label.slice(0, 19) + '...' : (d.data.isError ? '◉ ' : '') + d.data.label;\n      }).style('fill', function (d) {\n        return !d.data.isError ? '#3d444f' : '#E54C17';\n      });\n      nodeEnter.append('text').attr('class', 'node-text').attr('x', function (d) {\n        return d.children || d._children ? -15 : 15;\n      }).attr('dy', '1em').attr('fill', '#bbb').attr('text-anchor', function (d) {\n        return d.children || d._children ? 'end' : 'start';\n      }).style('font-size', '10px').text(function (d) {\n        return \"\".concat(d.data.layer || '').concat(d.data.component ? '-' + d.data.component : d.data.component || '');\n      });\n      nodeEnter.append('rect').attr('rx', 1).attr('ry', 1).attr('height', 2).attr('width', 100).attr('x', function (d) {\n        return d.children || d._children ? '-110' : '10';\n      }).attr('y', -1).style('fill', '#00000020');\n      nodeEnter.append('rect').attr('rx', 1).attr('ry', 1).attr('height', 2).attr('width', function (d) {\n        if (!d.data.endTime || !d.data.startTime) return 0;\n        return _this2.xScale(d.data.endTime - d.data.startTime) + 1 || 0;\n      }).attr('x', function (d) {\n        if (!d.data.endTime || !d.data.startTime) {\n          return 0;\n        }\n\n        if (d.children || d._children) {\n          return -110 + _this2.xScale(d.data.startTime - _this2.min);\n        }\n\n        return 10 + _this2.xScale(d.data.startTime - _this2.min);\n      }).attr('y', -1).style('fill', function (d) {\n        return _this2.sequentialScale(_this2.list.indexOf(d.data.serviceCode));\n      });\n      var nodeUpdate = nodeEnter.merge(node);\n      this.nodeUpdate = nodeUpdate;\n      nodeUpdate.transition().duration(600).attr('transform', function (d) {\n        return 'translate(' + d.y + ',' + d.x + ')';\n      }); // Update the node attributes and style\n\n      nodeUpdate.select('circle.node').attr('r', 5).style('fill', function (d) {\n        return d._children ? _this2.sequentialScale(_this2.list.indexOf(d.data.serviceCode)) : '#fff';\n      }).attr('cursor', 'pointer').on('click', function (d) {\n        d3.event.stopPropagation();\n        click(d);\n      }); // Remove any exiting nodes\n\n      var nodeExit = node.exit().transition().duration(600).attr('transform', function (d) {\n        return 'translate(' + source.y + ',' + source.x + ')';\n      }).remove();\n      nodeExit.select('circle').attr('r', 1e-6);\n      nodeExit.select('text').style('fill-opacity', 1e-6);\n      var link = this.svg.selectAll('path.tree-link').data(links, function (d) {\n        return d.id;\n      }).style('stroke-width', 1.5);\n      var linkEnter = link.enter().insert('path', 'g').attr('class', 'tree-link').attr('d', function (d) {\n        var o = {\n          x: source.x0,\n          y: source.y0\n        };\n        return diagonal(o, o);\n      }).style('stroke-width', 1.5);\n      var linkUpdate = linkEnter.merge(link);\n      linkUpdate.transition().duration(600).attr('d', function (d) {\n        return diagonal(d, d.parent);\n      });\n      var linkExit = link.exit().transition().duration(600).attr('d', function (d) {\n        var o = {\n          x: source.x,\n          y: source.y\n        };\n        return diagonal(o, o);\n      }).style('stroke-width', 1.5).remove();\n      nodes.forEach(function (d) {\n        d.x0 = d.x;\n        d.y0 = d.y;\n      });\n\n      function diagonal(s, d) {\n        return \"M \".concat(s.y, \" \").concat(s.x, \"\\n      C \").concat((s.y + d.y) / 2, \" \").concat(s.x, \", \").concat((s.y + d.y) / 2, \" \").concat(d.x, \",\\n      \").concat(d.y, \" \").concat(d.x);\n      }\n\n      function click(d) {\n        if (d.children) {\n          d._children = d.children;\n          d.children = null;\n        } else {\n          d.children = d._children;\n          d._children = null;\n        }\n\n        that.update(d);\n      }\n    }\n  }, {\n    key: \"setDefault\",\n    value: function setDefault() {\n      d3.selectAll('.time-inner').style('opacity', 1);\n      d3.selectAll('.time-inner-duration').style('opacity', 0);\n      d3.selectAll('.trace-tree-node-selfdur').style('opacity', 0);\n      d3.selectAll('.trace-tree-node-selfchild').style('opacity', 0);\n\n      this.nodeUpdate._groups[0].forEach(function (i) {\n        d3.select(i).style('opacity', 1);\n      });\n    }\n  }, {\n    key: \"getTopChild\",\n    value: function getTopChild() {\n      var _this3 = this;\n\n      d3.selectAll('.time-inner').style('opacity', 1);\n      d3.selectAll('.time-inner-duration').style('opacity', 0);\n      d3.selectAll('.trace-tree-node-selfdur').style('opacity', 0);\n      d3.selectAll('.trace-tree-node-selfchild').style('opacity', 1);\n\n      this.nodeUpdate._groups[0].forEach(function (i) {\n        d3.select(i).style('opacity', 0.2);\n\n        if (i.__data__.data.children.length >= _this3.topChildMin && i.__data__.data.children.length <= _this3.topChildMax) {\n          d3.select(i).style('opacity', 1);\n        }\n      });\n    }\n  }, {\n    key: \"getTopSlow\",\n    value: function getTopSlow() {\n      var _this4 = this;\n\n      d3.selectAll('.time-inner').style('opacity', 0);\n      d3.selectAll('.time-inner-duration').style('opacity', 1);\n      d3.selectAll('.trace-tree-node-selfchild').style('opacity', 0);\n      d3.selectAll('.trace-tree-node-selfdur').style('opacity', 1);\n\n      this.nodeUpdate._groups[0].forEach(function (i) {\n        d3.select(i).style('opacity', 0.2);\n\n        if (i.__data__.data.dur >= _this4.topSlowMin && i.__data__.data.dur <= _this4.topSlowMax) {\n          d3.select(i).style('opacity', 1);\n        }\n      });\n    }\n  }, {\n    key: \"getZoomBehavior\",\n    value: function getZoomBehavior(g) {\n      return d3.zoom().scaleExtent([0.3, 10]).on('zoom', function () {\n        g.attr('transform', \"translate(\".concat(d3.event.transform.x + 120, \",\").concat(d3.event.transform.y, \")scale(\").concat(d3.event.transform.k, \")\"));\n      });\n    }\n  }]);\n\n  return TraceMap;\n}();\n\nexport { TraceMap as default };",{"version":3,"sources":["/Volumes/Files/Study/apm/apache-skywalking-apm-8.0.1/skywalking-ui/src/views/components/trace/d3-trace-tree.js"],"names":["d3","d3tip","i","TraceMap","el","scope","topSlow","topChild","width","clientWidth","height","clientHeight","body","select","append","attr","tip","offset","html","d","data","label","dur","endTime","startTime","svg","call","transform","zoomTransform","translate","zoom","row","treemap","tree","size","length","min","map","max","list","serviceCode","xScale","scaleLinear","range","domain","sequentialScale","scaleSequential","interpolator","interpolateCool","getZoomBehavior","root","hierarchy","children","x0","y0","that","forEach","collapse","topSlowMax","sort","a","b","topSlowMin","topChildMax","topChildMin","update","push","childrenLength","source","treeData","nodes","descendants","links","slice","y","depth","node","selectAll","id","nodeEnter","enter","on","show","timeUpdate","_node","_groups","filter","group","__data__","timeTip","hide","event","stopPropagation","handleSelectSpan","style","_children","indexOf","text","isError","layer","component","nodeUpdate","merge","transition","duration","x","click","nodeExit","exit","remove","link","linkEnter","insert","o","diagonal","linkUpdate","parent","linkExit","s","g","scaleExtent","k"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable */\nimport * as d3 from 'd3';\nimport d3tip from 'd3-tip';\nvar i = 0;\nexport default class TraceMap {\n  constructor(el, scope) {\n    this.el = el;\n    this.scope = scope;\n    this.i = 0;\n    this.topSlow = [];\n    this.topChild = [];\n    this.width = el.clientWidth;\n    this.height = el.clientHeight - 28;\n    this.body = d3\n      .select(this.el)\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height);\n    this.tip = d3tip()\n      .attr('class', 'd3-tip')\n      .offset([-8, 0])\n      .html(\n        (d) => `\n      <div class=\"mb-5\">${d.data.label}</div>\n      ${\n        d.data.dur\n          ? '<div class=\"sm\">SelfDuration: ' + d.data.dur + 'ms</div>'\n          : ''\n      }\n      ${\n        d.data.endTime - d.data.startTime\n          ? '<div class=\"sm\">TotalDuration: ' +\n            (d.data.endTime - d.data.startTime) +\n            'ms</div>'\n          : ''\n      }\n      `,\n      );\n    this.svg = this.body\n      .append('g')\n      .attr('transform', (d) => `translate(120, 0)`);\n    this.svg.call(this.tip);\n  }\n  resize() {\n    // reset svg size\n    this.width = this.el.clientWidth;\n    this.height = this.el.clientHeight - 28;\n    this.body.attr('width', this.width).attr('height', this.height);\n    this.body.select('g').attr('transform', (d) => `translate(160, 0)`);\n    // reset zoom function for translate\n    const transform = d3.zoomTransform(0).translate(0, 0);\n    d3.zoom().transform(this.body, transform);\n  }\n  init(data, row) {\n    this.treemap = d3.tree().size([row.length * 35, this.width]);\n    this.row = row;\n    this.data = data;\n    this.min = d3.min(this.row.map((i) => i.startTime));\n    this.max = d3.max(this.row.map((i) => i.endTime - this.min));\n    this.list = Array.from(new Set(this.row.map((i) => i.serviceCode)));\n    this.xScale = d3\n      .scaleLinear()\n      .range([0, 100])\n      .domain([0, this.max]);\n    this.sequentialScale = d3\n      .scaleSequential()\n      .domain([0, this.list.length + 1])\n      .interpolator(d3.interpolateCool);\n\n    this.body.call(this.getZoomBehavior(this.svg));\n    this.root = d3.hierarchy(this.data, (d) => d.children);\n    this.root.x0 = this.height / 2;\n    this.root.y0 = 0;\n    this.topSlow = [];\n    this.topChild = [];\n    const that = this;\n    this.root.children.forEach(collapse);\n    this.topSlowMax = this.topSlow.sort((a, b) => b - a)[0];\n    this.topSlowMin = this.topSlow.sort((a, b) => b - a)[4];\n    this.topChildMax = this.topChild.sort((a, b) => b - a)[0];\n    this.topChildMin = this.topChild.sort((a, b) => b - a)[4];\n    this.update(this.root);\n    // Collapse the node and all it's children\n    function collapse(d) {\n      if (d.children) {\n        let dur = d.data.endTime - d.data.startTime;\n        d.children.forEach((i) => {\n          dur -= i.data.endTime - i.data.startTime;\n        });\n        d.dur = dur < 0 ? 0 : dur;\n        that.topSlow.push(dur);\n        that.topChild.push(d.children.length);\n        d.childrenLength = d.children.length;\n        d.children.forEach(collapse);\n      }\n    }\n  }\n  draw() {\n    this.update(this.root);\n  }\n  update(source) {\n    const that = this;\n    var treeData = this.treemap(this.root);\n    var nodes = treeData.descendants(),\n      links = treeData.descendants().slice(1);\n\n    nodes.forEach(function(d) {\n      d.y = d.depth * 140;\n    });\n\n    var node = this.svg.selectAll('g.node').data(nodes, function(d) {\n      return d.id || (d.id = ++i);\n    });\n\n    var nodeEnter = node\n      .enter()\n      .append('g')\n      .attr('class', 'node')\n      .attr('cursor', 'pointer')\n      .attr('transform', function(d) {\n        return 'translate(' + source.y0 + ',' + source.x0 + ')';\n      })\n      .on('mouseover', function(d, i) {\n        that.tip.show(d, this);\n        if (!that.timeUpdate) {\n          return;\n        }\n        const _node = that.timeUpdate._groups[0].filter(\n          (group) => group.__data__.id === i + 1,\n        );\n        if (_node.length) {\n          that.timeTip.show(d, _node[0].children[1]);\n        }\n      })\n      .on('mouseout', function(d, i) {\n        that.tip.hide(d, this);\n        if (!that.timeUpdate) {\n          return;\n        }\n        const _node = that.timeUpdate._groups[0].filter(\n          (group) => group.__data__.id === i + 1,\n        );\n        if (_node.length) {\n          that.timeTip.hide(d, _node[0].children[1]);\n        }\n      })\n      .on('click', function(d) {\n        d3.event.stopPropagation();\n        that.scope.handleSelectSpan(d);\n      });\n\n    nodeEnter\n      .append('circle')\n      .attr('class', 'node')\n      .attr('r', 1e-6)\n      .style('fill', (d) =>\n        d._children\n          ? this.sequentialScale(this.list.indexOf(d.data.serviceCode))\n          : '#fff',\n      )\n      .attr('stroke', (d) =>\n        this.sequentialScale(this.list.indexOf(d.data.serviceCode)),\n      )\n      .attr('stroke-width', 2.5);\n\n    nodeEnter\n      .append('text')\n      .attr('font-size', 11)\n      .attr('dy', '-0.5em')\n      .attr('x', function(d) {\n        return d.children || d._children ? -15 : 15;\n      })\n      .attr('text-anchor', function(d) {\n        return d.children || d._children ? 'end' : 'start';\n      })\n      .text((d) =>\n        d.data.label.length > 19\n          ? (d.data.isError ? '◉ ' : '') + d.data.label.slice(0, 19) + '...'\n          : (d.data.isError ? '◉ ' : '') + d.data.label,\n      )\n      .style('fill', (d) => (!d.data.isError ? '#3d444f' : '#E54C17'));\n    nodeEnter\n      .append('text')\n      .attr('class', 'node-text')\n      .attr('x', function(d) {\n        return d.children || d._children ? -15 : 15;\n      })\n      .attr('dy', '1em')\n      .attr('fill', '#bbb')\n      .attr('text-anchor', function(d) {\n        return d.children || d._children ? 'end' : 'start';\n      })\n      .style('font-size', '10px')\n      .text(\n        (d) =>\n          `${d.data.layer || ''}${\n            d.data.component ? '-' + d.data.component : d.data.component || ''\n          }`,\n      );\n    nodeEnter\n      .append('rect')\n      .attr('rx', 1)\n      .attr('ry', 1)\n      .attr('height', 2)\n      .attr('width', 100)\n      .attr('x', function(d) {\n        return d.children || d._children ? '-110' : '10';\n      })\n      .attr('y', -1)\n      .style('fill', '#00000020');\n    nodeEnter\n      .append('rect')\n      .attr('rx', 1)\n      .attr('ry', 1)\n      .attr('height', 2)\n      .attr('width', (d) => {\n        if (!d.data.endTime || !d.data.startTime) return 0;\n        return this.xScale(d.data.endTime - d.data.startTime) + 1 || 0;\n      })\n      .attr('x', (d) => {\n        if (!d.data.endTime || !d.data.startTime) {\n          return 0;\n        }\n        if (d.children || d._children) {\n          return -110 + this.xScale(d.data.startTime - this.min);\n        }\n        return 10 + this.xScale(d.data.startTime - this.min);\n      })\n      .attr('y', -1)\n      .style('fill', (d) =>\n        this.sequentialScale(this.list.indexOf(d.data.serviceCode)),\n      );\n    var nodeUpdate = nodeEnter.merge(node);\n    this.nodeUpdate = nodeUpdate;\n    nodeUpdate\n      .transition()\n      .duration(600)\n      .attr('transform', function(d) {\n        return 'translate(' + d.y + ',' + d.x + ')';\n      });\n\n    // Update the node attributes and style\n    nodeUpdate\n      .select('circle.node')\n      .attr('r', 5)\n      .style('fill', (d) =>\n        d._children\n          ? this.sequentialScale(this.list.indexOf(d.data.serviceCode))\n          : '#fff',\n      )\n      .attr('cursor', 'pointer')\n      .on('click', (d) => {\n        d3.event.stopPropagation();\n        click(d);\n      });\n\n    // Remove any exiting nodes\n    var nodeExit = node\n      .exit()\n      .transition()\n      .duration(600)\n      .attr('transform', function(d) {\n        return 'translate(' + source.y + ',' + source.x + ')';\n      })\n      .remove();\n\n    nodeExit.select('circle').attr('r', 1e-6);\n\n    nodeExit.select('text').style('fill-opacity', 1e-6);\n\n    var link = this.svg\n      .selectAll('path.tree-link')\n      .data(links, function(d) {\n        return d.id;\n      })\n      .style('stroke-width', 1.5);\n\n    var linkEnter = link\n      .enter()\n      .insert('path', 'g')\n      .attr('class', 'tree-link')\n      .attr('d', function(d) {\n        var o = { x: source.x0, y: source.y0 };\n        return diagonal(o, o);\n      })\n      .style('stroke-width', 1.5);\n\n    var linkUpdate = linkEnter.merge(link);\n    linkUpdate\n      .transition()\n      .duration(600)\n      .attr('d', function(d) {\n        return diagonal(d, d.parent);\n      });\n\n    var linkExit = link\n      .exit()\n      .transition()\n      .duration(600)\n      .attr('d', function(d) {\n        var o = { x: source.x, y: source.y };\n        return diagonal(o, o);\n      })\n      .style('stroke-width', 1.5)\n      .remove();\n\n    nodes.forEach(function(d) {\n      d.x0 = d.x;\n      d.y0 = d.y;\n    });\n    function diagonal(s, d) {\n      return `M ${s.y} ${s.x}\n      C ${(s.y + d.y) / 2} ${s.x}, ${(s.y + d.y) / 2} ${d.x},\n      ${d.y} ${d.x}`;\n    }\n    function click(d) {\n      if (d.children) {\n        d._children = d.children;\n        d.children = null;\n      } else {\n        d.children = d._children;\n        d._children = null;\n      }\n      that.update(d);\n    }\n  }\n  setDefault() {\n    d3.selectAll('.time-inner').style('opacity', 1);\n    d3.selectAll('.time-inner-duration').style('opacity', 0);\n    d3.selectAll('.trace-tree-node-selfdur').style('opacity', 0);\n    d3.selectAll('.trace-tree-node-selfchild').style('opacity', 0);\n    this.nodeUpdate._groups[0].forEach((i) => {\n      d3.select(i).style('opacity', 1);\n    });\n  }\n  getTopChild() {\n    d3.selectAll('.time-inner').style('opacity', 1);\n    d3.selectAll('.time-inner-duration').style('opacity', 0);\n    d3.selectAll('.trace-tree-node-selfdur').style('opacity', 0);\n    d3.selectAll('.trace-tree-node-selfchild').style('opacity', 1);\n    this.nodeUpdate._groups[0].forEach((i) => {\n      d3.select(i).style('opacity', 0.2);\n      if (\n        i.__data__.data.children.length >= this.topChildMin &&\n        i.__data__.data.children.length <= this.topChildMax\n      ) {\n        d3.select(i).style('opacity', 1);\n      }\n    });\n  }\n  getTopSlow() {\n    d3.selectAll('.time-inner').style('opacity', 0);\n    d3.selectAll('.time-inner-duration').style('opacity', 1);\n    d3.selectAll('.trace-tree-node-selfchild').style('opacity', 0);\n    d3.selectAll('.trace-tree-node-selfdur').style('opacity', 1);\n    this.nodeUpdate._groups[0].forEach((i) => {\n      d3.select(i).style('opacity', 0.2);\n      if (\n        i.__data__.data.dur >= this.topSlowMin &&\n        i.__data__.data.dur <= this.topSlowMax\n      ) {\n        d3.select(i).style('opacity', 1);\n      }\n    });\n  }\n  getZoomBehavior(g) {\n    return d3\n      .zoom()\n      .scaleExtent([0.3, 10])\n      .on('zoom', () => {\n        g.attr(\n          'transform',\n          `translate(${d3.event.transform.x + 120},${\n            d3.event.transform.y\n          })scale(${d3.event.transform.k})`,\n        );\n      });\n  }\n}\n"]}]}